@model IEnumerable<MVC.Models.tblemp>

@{
    ViewData["Title"] = "Employee Management";
    Layout = null;
}

<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Employee Management</title>
    <link href="https://kendo.cdn.telerik.com/2022.1.301/styles/kendo.default-v2.min.css" rel="stylesheet" />
    <style>
        /* Your CSS styles here */
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://kendo.cdn.telerik.com/2022.1.301/js/kendo.all.min.js"></script>
</head>
<body>
    <div class="container">
        <h2>Employee Management</h2>
        
        <!-- Insert and update form -->
        <div class="form-group">
            <h3>Create/Update Employee</h3>
            <div>
                <label for="empName">Employee Name:</label>
                <input id="empName" type="text" /><br>
                <label>Gender:</label>
                <input type="radio" id="male" name="gender" value="male">
                <label for="male">Male</label>
                <input type="radio" id="female" name="gender" value="female">
                <label for="female">Female</label><br>
                <label for="dob">Date of Birth:</label>
                <input id="dob" type="text" /><br>
                <label for="deptId">Department ID:</label>
                <input id="deptId" style="width: 100%;" />
                <!-- Dropdown for Department ID -->
                <br>
                <label>Shift:</label><br>
                <input id="dayShift" type="checkbox" name="shift" value="day">
                <label for="dayShift">Day Shift</label><br>
                <input id="nightShift" type="checkbox" name="shift" value="night">
                <label for="nightShift">Night Shift</label><br>
                <label for="image">Image:</label>
                <input id="image" type="file" />
            </div>
            <button id="createBtn">Create/Update</button>
        </div>

        <hr />

        <!-- Display employee list in a table -->
        <div>
            <h3>Employee List</h3>
            <table id="employeeTable">
                <thead>
                    <tr>
                        <th>Employee Name</th>
                        <th>Gender</th>
                        <th>Date of Birth</th>
                        <th>Shift</th>
                        <th>Department ID</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var emp in Model)
                    {
                        <tr data-id="@emp.c_empid">
                            <td>@emp.c_empname</td>
                            <td>@emp.c_gender</td>
                            <td>@emp.c_dob.ToShortDateString()</td>
                            <td>@emp.c_shift</td>
                            <td>@emp.c_depid</td>
                            <td><button class="editBtn">Edit</button> <button class="deleteBtn">Delete</button></td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            // Initialize Kendo DatePicker for Date of Birth
            $("#dob").kendoDatePicker({
                format: "yyyy-MM-dd"
            });

            // Initialize Kendo CheckBoxes for Shift
            $("#dayShift, #nightShift").kendoCheckBox();

            // Initialize Kendo DropDownList for Department ID
            $("#deptId").kendoDropDownList({
                dataTextField: "deptName", // Field from the Department table
                dataValueField: "deptId", // Field from the Department table
                dataSource: {
                    // Your data source for departments from another table
                    // Example:
                    // data: [{ deptId: 1, deptName: "Department 1" }, { deptId: 2, deptName: "Department 2" }]
                },
                optionLabel: "Select Department..."
            });

            // API URLs
            var apiUrl = {
                createOrUpdate: "https://localhost:7123/api/KendoEmpComponentApi/CreateOrUpdate",
                delete: "https://localhost:7123/api/KendoEmpComponentApi/Delete"
            };

            // Create/Update
            $("#createBtn").click(function () {
                var empData = {
                    empName: $("#empName").val(),
                    gender: $("input[name='gender']:checked").val(),
                    dob: $("#dob").val(),
                    deptId: $("#deptId").val(),
                    image: $("#image").val() // This may not work as expected due to security reasons
                };

                // Send AJAX request
                $.ajax({
                    url: apiUrl.createOrUpdate,
                    type: "POST",
                    dataType: "json",
                    contentType: "application/json",
                    data: JSON.stringify(empData),
                    success: function (data) {
                        console.log("Employee data saved successfully");
                        // Optionally, perform additional actions upon success
                    },
                    error: function (xhr, status, error) {
                        console.error("Error saving employee data:", error);
                        // Optionally, handle errors and display messages to the user
                    }
                });
            });

            // Delete employee
            $("#employeeTable").on("click", ".deleteBtn", function () {
                var empId = $(this).closest("tr").data("id");

                $.ajax({
                    url: apiUrl.delete + "/" + empId,
                    type: "DELETE",
                    dataType: "json",
                    success: function (data) {
                        // Handle success
                        console.log("Employee deleted successfully");
                        // You may want to refresh the employee list after delete
                    },
                    error: function (xhr, status, error) {
                        // Handle error
                        console.error("Error deleting employee:", error);
                    }
                });
            });
        });
    </script>
</body>
</html>
